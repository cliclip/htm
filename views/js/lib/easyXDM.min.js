(function(e,t,n,r,i,s){function E(e,t){var n=typeof e[t];return n=="function"||n=="object"&&!!e[t]||n=="unknown"}function S(e,t){return typeof e[t]=="object"&&!!e[t]}function x(e){return Object.prototype.toString.call(e)==="[object Array]"}function T(){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return y=Array.prototype.slice.call(e.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),b=parseInt(y[0],10)>9&&parseInt(y[1],10)>0,e=null,!0}catch(t){return!1}}function O(){if(k)return;k=!0,w("firing dom_onReady");for(var e=0;e<L.length;e++)L[e]();L.length=0}function _(e,t){if(k){e.call(t);return}L.push(function(){e.call(t)})}function D(){var e=parent;if(h!=="")for(var t=0,n=h.split(".");t<n.length;t++){if(!e)throw new Error(n.slice(0,t+1).join(".")+" is not an object");e=e[n[t]]}if(!e||!e.easyXDM)throw new Error("Could not find easyXDM in parent."+h);return e.easyXDM}function P(t){if(typeof t!="string"||!t)throw new Error("namespace must be a non-empty string");return w("Settings namespace to '"+t+"'"),e.easyXDM=d,h=t,h&&(v="easyXDM_"+h.replace(".","_")+"_"),p}function H(e){if(!e)throw new Error("url is undefined or empty");return e.match(f)[3]}function B(e){if(!e)throw new Error("url is undefined or empty");return e.match(f)[4]||""}function j(e){if(!e)throw new Error("url is undefined or empty");if(/^file/.test(e))return"file:///";var t=e.toLowerCase().match(f),n=t[2],r=t[3],i=t[4]||"";if(n=="http:"&&i==":80"||n=="https:"&&i==":443")i="";return n+"//"+r+i}function F(e){if(!e)throw new Error("url is undefined or empty");e=e.replace(c,"$1/");if(!e.match(/^(http||https):\/\//)){var t=e.substring(0,1)==="/"?"":n.pathname;t.substring(t.length-1)!=="/"&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=n.protocol+"//"+n.host+t+e}while(l.test(e))e=e.replace(l,"");return w("resolved url '"+e+"'"),e}function I(e,t){if(!t)throw new Error("parameters is undefined or null");var n="",r=e.indexOf("#");r!==-1&&(n=e.substring(r),e=e.substring(0,r));var i=[];for(var o in t)t.hasOwnProperty(o)&&i.push(o+"="+s(t[o]));return e+(g?"#":e.indexOf("?")==-1?"?":"&")+i.join("&")+n}function R(e){return typeof e=="undefined"}function z(e,t,n){var r;for(var i in t)t.hasOwnProperty(i)&&(i in e?(r=t[i],typeof r=="object"?z(e[i],r,n):n||(e[i]=t[i])):e[i]=t[i]);return e}function W(){var e=t.body.appendChild(t.createElement("form")),n=e.appendChild(t.createElement("input"));n.name=v+"TEST"+u,m=n!==e.elements[n.name],t.body.removeChild(e),w("HAS_NAME_PROPERTY_BUG: "+m)}function X(e){w("creating frame: "+e.props.src),R(m)&&W();var n;m?n=t.createElement('<iframe name="'+e.props.name+'"/>'):(n=t.createElement("IFRAME"),n.name=e.props.name),n.id=n.name=e.props.name,delete e.props.name,e.onLoad&&N(n,"load",e.onLoad),typeof e.container=="string"&&(e.container=t.getElementById(e.container)),e.container||(z(n.style,{position:"absolute",top:"-2000px"}),e.container=t.body);var r=e.props.src;return delete e.props.src,z(n,e.props),n.border=n.frameBorder=0,n.allowTransparency=!0,e.container.appendChild(n),n.src=r,e.props.src=r,n}function V(e,t){typeof e=="string"&&(e=[e]);var n,r=e.length;while(r--){n=e[r],n=new RegExp(n.substr(0,1)=="^"?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$");if(n.test(t))return!0}return!1}function $(r){var i=r.protocol,s;r.isHost=r.isHost||R(q.xdm_p),g=r.hash||!1,w("preparing transport stack"),r.props||(r.props={});if(!r.isHost){w("using parameters from query"),r.channel=q.xdm_c,r.secret=q.xdm_s,r.remote=q.xdm_e,i=q.xdm_p;if(r.acl&&!V(r.acl,r.remote))throw new Error("Access denied for "+r.remote)}else r.remote=F(r.remote),r.channel=r.channel||"default"+u++,r.secret=Math.random().toString(16).substring(2),R(i)?(j(n.href)==j(r.remote)?i="4":E(e,"postMessage")||E(t,"postMessage")?i="1":r.swf&&E(e,"ActiveXObject")&&T()?i="6":navigator.product==="Gecko"&&"frameElement"in e&&navigator.userAgent.indexOf("WebKit")==-1?i="5":r.remoteHelper?(r.remoteHelper=F(r.remoteHelper),i="2"):i="0",w("selecting protocol: "+i)):w("using protocol: "+i);r.protocol=i;switch(i){case"0":z(r,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0);if(r.isHost){if(!r.local){w("looking for image to use as local");var o=n.protocol+"//"+n.host,a=t.body.getElementsByTagName("img"),f,l=a.length;while(l--){f=a[l];if(f.src.substring(0,o.length)===o){r.local=f.src;break}}r.local||(w("no image found, defaulting to using the window"),r.local=e)}var c={xdm_c:r.channel,xdm_p:0};r.local===e?(r.usePolling=!0,r.useParent=!0,r.local=n.protocol+"//"+n.host+n.pathname+n.search,c.xdm_e=r.local,c.xdm_pa=1):c.xdm_e=F(r.local),r.container&&(r.useResize=!1,c.xdm_po=1),r.remote=I(r.remote,c)}else z(r,{channel:q.xdm_c,remote:q.xdm_e,useParent:!R(q.xdm_pa),usePolling:!R(q.xdm_po),useResize:r.useParent?!1:r.useResize});s=[new p.stack.HashTransport(r),new p.stack.ReliableBehavior({}),new p.stack.QueueBehavior({encode:!0,maxLength:4e3-r.remote.length}),new p.stack.VerifyBehavior({initiate:r.isHost})];break;case"1":s=[new p.stack.PostMessageTransport(r)];break;case"2":s=[new p.stack.NameTransport(r),new p.stack.QueueBehavior,new p.stack.VerifyBehavior({initiate:r.isHost})];break;case"3":s=[new p.stack.NixTransport(r)];break;case"4":s=[new p.stack.SameOriginTransport(r)];break;case"5":s=[new p.stack.FrameElementTransport(r)];break;case"6":y||T(),s=[new p.stack.FlashTransport(r)]}return s.push(new p.stack.QueueBehavior({lazy:r.lazy,remove:!0})),s}function J(e){var t,n={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var r=0,i=e.length;r<i;r++)t=e[r],z(t,n,!0),r!==0&&(t.down=e[r-1]),r!==i-1&&(t.up=e[r+1]);return t}function K(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var o=this,u=Math.floor(Math.random()*1e4),a=Function.prototype,f=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,l=/[\-\w]+\/\.\.\//,c=/([^:])\/\//g,h="",p={},d=e.easyXDM,v="easyXDM_",m,g=!1,y,b,w=a,N,C;if(E(e,"addEventListener"))N=function(e,t,n){w("adding listener "+t),e.addEventListener(t,n,!1)},C=function(e,t,n){w("removing listener "+t),e.removeEventListener(t,n,!1)};else{if(!E(e,"attachEvent"))throw new Error("Browser not supported");N=function(e,t,n){w("adding listener "+t),e.attachEvent("on"+t,n)},C=function(e,t,n){w("removing listener "+t),e.detachEvent("on"+t,n)}}var k=!1,L=[],A;"readyState"in t?(A=t.readyState,k=A=="complete"||~navigator.userAgent.indexOf("AppleWebKit/")&&(A=="loaded"||A=="interactive")):k=!!t.body;if(!k){if(E(e,"addEventListener"))N(t,"DOMContentLoaded",O);else{N(t,"readystatechange",function(){t.readyState=="complete"&&O()});if(t.documentElement.doScroll&&e===top){var M=function(){if(k)return;try{t.documentElement.doScroll("left")}catch(e){r(M,1);return}O()};M()}}N(e,"load",O)}var q=function(e){e=e.substring(1).split("&");var t={},n,r=e.length;while(r--)n=e[r].split("="),t[n[0]]=i(n[1]);return t}(/xdm_e=/.test(n.search)?n.search:n.hash),U=function(){var e={},t={a:[1,2,3]},n='{"a":[1,2,3]}';return typeof JSON!="undefined"&&typeof JSON.stringify=="function"&&JSON.stringify(t).replace(/\s/g,"")===n?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===n&&(e.stringify=Object.toJSON),typeof String.prototype.evalJSON=="function"&&(t=n.evalJSON(),t.a&&t.a.length===3&&t.a[2]===3&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(U=function(){return e},e):null)};z(p,{version:"2.4.15.118",query:q,stack:{},apply:z,getJSONObject:U,whenReady:_,noConflict:P}),z(p,{checkAcl:V,getDomainName:H,getLocation:j,appendQueryParameters:I});var Q={_deferred:[],flush:function(){this.trace("... deferred messages ...");for(var e=0,t=this._deferred.length;e<t;e++)this.trace(this._deferred[e]);this._deferred.length=0,this.trace("... end of deferred messages ...")},getTime:function(){var e=new Date,t=e.getHours()+"",n=e.getMinutes()+"",r=e.getSeconds()+"",i=e.getMilliseconds()+"",s="000";return t.length==1&&(t="0"+t),n.length==1&&(n="0"+n),r.length==1&&(r="0"+r),i=s.substring(i.length)+i,t+":"+n+":"+r+"."+i},log:function(t){!S(e,"console")||R(console.log)?this.log=a:this.log=function(e){},this.log(t)},trace:function(r){if(!k)this._deferred.length===0&&p.whenReady(Q.flush,Q),this._deferred.push(r),this.log(r);else{var i=t.getElementById("log");if(i)this.trace=function(e){try{i.appendChild(t.createElement("div")).appendChild(t.createTextNode(n.host+(h?":"+h:"")+" - "+this.getTime()+":"+e)),i.scrollTop=i.scrollHeight}catch(r){}};else if(S(e,"console")&&!R(console.info))this.trace=function(e){};else{var s=n.host,o=s.replace(/\[-.:]/g,"")+"easyxdm_log",u;try{u=e.open("",o,"width=800,height=200,status=0,navigation=0,scrollbars=1")}catch(f){}if(u){var l=u.document;i=l.getElementById("log"),i||(l.write("<html><head><title>easyXDM log "+s+"</title></head>"),l.write('<body><div id="log"></div></body></html>'),l.close(),i=l.getElementById("log")),this.trace=function(e){try{i.appendChild(l.createElement("div")).appendChild(l.createTextNode(n.host+(h?":"+h:"")+" - "+this.getTime()+":"+e)),i.scrollTop=i.scrollHeight}catch(t){}},this.trace("---- new logger at "+n.href)}i||(this.trace=a)}this.trace(r)}},getTracer:function(e){return function(t){Q.trace(e+": "+t)}}};Q.log("easyXDM present on '"+n.href),p.Debug=Q,w=Q.getTracer("{Private}"),p.DomHelper={on:N,un:C,requiresJSON:function(n){S(e,"JSON")?Q.log("native JSON found"):(Q.log("loading external JSON"),t.write('<script type="text/javascript" src="'+n+'"><'+"/script>"))}},function(){var e={};p.Fn={set:function(t,n){this._trace("storing function "+t),e[t]=n},get:function(t,n){this._trace("retrieving function "+t);var r=e[t];return r||this._trace(t+" not found"),n&&delete e[t],r}},p.Fn._trace=Q.getTracer("easyXDM.Fn")}(),p.Socket=function(e){var t=Q.getTracer("easyXDM.Socket");t("constructor");var n=J($(e).concat([{incoming:function(t,n){e.onMessage(t,n)},callback:function(t){e.onReady&&e.onReady(t)}}])),r=j(e.remote);this.origin=j(e.remote),this.destroy=function(){n.destroy()},this.postMessage=function(e){n.outgoing(e,r)},n.init()},p.Rpc=function(e,t){var n=Q.getTracer("easyXDM.Rpc");n("constructor");if(t.local)for(var r in t.local)if(t.local.hasOwnProperty(r)){var i=t.local[r];typeof i=="function"&&(t.local[r]={method:i})}var s=J($(e).concat([new p.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=j(e.remote),this.destroy=function(){s.destroy()},s.init()},p.stack.SameOriginTransport=function(e){var t=Q.getTracer("easyXDM.stack.SameOriginTransport");t("constructor");var i,s,o,u;return i={outgoing:function(e,t,n){o(e),n&&n()},destroy:function(){t("destroy"),s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){t("init"),u=j(e.remote),e.isHost?(z(e.props,{src:I(e.remote,{xdm_e:n.protocol+"//"+n.host+n.pathname,xdm_c:e.channel,xdm_p:4}),name:v+e.channel+"_provider"}),s=X(e),p.Fn.set(e.channel,function(e){return o=e,r(function(){i.up.callback(!0)},0),function(e){i.up.incoming(e,u)}})):(o=D().Fn.get(e.channel,!0)(function(e){i.up.incoming(e,u)}),r(function(){i.up.callback(!0)},0))},init:function(){_(i.onDOMReady,i)}}},p.stack.FlashTransport=function(e){function d(e,t){r(function(){i("received message"),s.up.incoming(e,f)},0)}function m(n){i("creating factory with SWF from "+n);var r=e.swf+"?host="+e.isHost,s="easyXDM_swf_"+Math.floor(Math.random()*1e4);p.Fn.set("flash_loaded"+n.replace(/[\-.]/g,"_"),function(){p.stack.FlashTransport[n].swf=l=c.firstChild;var e=p.stack.FlashTransport[n].queue;for(var t=0;t<e.length;t++)e[t]();e.length=0}),e.swfContainer?c=typeof e.swfContainer=="string"?t.getElementById(e.swfContainer):e.swfContainer:(c=t.createElement("div"),z(c.style,b&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(c));var u="callback=flash_loaded"+n.replace(/[\-.]/g,"_")+"&proto="+o.location.protocol+"&domain="+H(o.location.href)+"&port="+B(o.location.href)+"&ns="+h;u+="&log=true",c.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+s+"' data='"+r+"'>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='wmode' value='transparent'>"+"<param name='movie' value='"+r+"'></param>"+"<param name='flashvars' value='"+u+"'></param>"+"<embed type='application/x-shockwave-flash' FlashVars='"+u+"' allowScriptAccess='always' wmode='transparent' src='"+r+"' height='1' width='1'></embed>"+"</object>"}var i=Q.getTracer("easyXDM.stack.FlashTransport");i("constructor");if(!e.swf)throw new Error("Path to easyxdm.swf is missing");var s,u,a,f,l,c;return s={outgoing:function(t,n,r){l.postMessage(e.channel,t.toString()),r&&r()},destroy:function(){i("destroy");try{l.destroyChannel(e.channel)}catch(t){}l=null,u&&(u.parentNode.removeChild(u),u=null)},onDOMReady:function(){i("init"),f=e.remote,p.Fn.set("flash_"+e.channel+"_init",function(){r(function(){i("firing onReady"),s.up.callback(!0)})}),p.Fn.set("flash_"+e.channel+"_onMessage",d),e.swf=F(e.swf);var t=H(e.swf),o=function(){p.stack.FlashTransport[t].init=!0,l=p.stack.FlashTransport[t].swf,l.createChannel(e.channel,e.secret,j(e.remote),e.isHost),e.isHost&&(b&&e.swfNoThrottle&&z(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),z(e.props,{src:I(e.remote,{xdm_e:j(n.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:v+e.channel+"_provider"}),u=X(e))};p.stack.FlashTransport[t]&&p.stack.FlashTransport[t].init?o():p.stack.FlashTransport[t]?p.stack.FlashTransport[t].queue.push(o):(p.stack.FlashTransport[t]={queue:[o]},m(t))},init:function(){_(s.onDOMReady,s)}}},p.stack.PostMessageTransport=function(t){function f(e){if(e.origin&&e.origin==="null")return"file:///";if(e.origin)return j(e.origin);if(e.uri)return j(e.uri);if(e.domain)return n.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function l(e){var n=f(e);i("received message '"+e.data+"' from "+n),n==a&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&s.up.incoming(e.data.substring(t.channel.length+1),n)}var i=Q.getTracer("easyXDM.stack.PostMessageTransport");i("constructor");var s,o,u,a;return s={outgoing:function(e,n,r){u.postMessage(t.channel+" "+e,n||a=="file:///"?"*":a),r&&r()},destroy:function(){i("destroy"),C(e,"message",l),o&&(u=null,o.parentNode.removeChild(o),o=null)},onDOMReady:function(){i("init"),a=j(t.remote);if(t.isHost){var f=function(n){n.data==t.channel+"-ready"&&(i("firing onReady"),u="postMessage"in o.contentWindow?o.contentWindow:o.contentWindow.document,C(e,"message",f),N(e,"message",l),r(function(){s.up.callback(!0)},0))};N(e,"message",f),z(t.props,{src:I(t.remote,{xdm_e:j(n.href),xdm_c:t.channel,xdm_p:1}),name:v+t.channel+"_provider"}),o=X(t)}else N(e,"message",l),u="postMessage"in e.parent?e.parent:e.parent.document,u.postMessage(t.channel+"-ready",a=="file:///"?"*":a),r(function(){s.up.callback(!0)},0)},init:function(){_(s.onDOMReady,s)}}},p.stack.FrameElementTransport=function(i){var s=Q.getTracer("easyXDM.stack.FrameElementTransport");s("constructor");var o,u,a,f;return o={outgoing:function(e,t,n){a.call(this,e),n&&n()},destroy:function(){s("destroy"),u&&(u.parentNode.removeChild(u),u=null)},onDOMReady:function(){s("init"),f=j(i.remote),i.isHost?(z(i.props,{src:I(i.remote,{xdm_e:j(n.href),xdm_c:i.channel,xdm_p:5}),name:v+i.channel+"_provider"}),u=X(i),u.fn=function(e){return delete u.fn,a=e,r(function(){o.up.callback(!0)},0),function(e){o.up.incoming(e,f)}}):(t.referrer&&j(t.referrer)!=q.xdm_e&&(e.top.location=q.xdm_e),a=e.frameElement.fn(function(e){o.up.incoming(e,f)}),o.up.callback(!0))},init:function(){_(o.onDOMReady,o)}}},p.stack.NameTransport=function(e){function c(n){var r=e.remoteHelper+(i?"#_3":"#_2")+e.channel;t("sending message "+n),t("navigating to  '"+r+"'"),s.contentWindow.sendMessage(n,r)}function h(){i?(++u===2||!i)&&n.up.callback(!0):(c("ready"),t("calling onReady"),n.up.callback(!0))}function d(e){t("received message "+e),n.up.incoming(e,f)}function m(){a&&r(function(){a(!0)},0)}var t=Q.getTracer("easyXDM.stack.NameTransport");t("constructor");if(e.isHost&&R(e.remoteHelper))throw t("missing remoteHelper"),new Error("missing remoteHelper");var n,i,s,o,u,a,f,l;return n={outgoing:function(e,t,n){a=n,c(e)},destroy:function(){t("destroy"),s.parentNode.removeChild(s),s=null,i&&(o.parentNode.removeChild(o),o=null)},onDOMReady:function(){t("init"),i=e.isHost,u=0,f=j(e.remote),e.local=F(e.local),i?(p.Fn.set(e.channel,function(n){t("received initial message "+n),i&&n==="ready"&&(p.Fn.set(e.channel,d),h())}),l=I(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),z(e.props,{src:l+"#"+e.channel,name:v+e.channel+"_provider"}),o=X(e)):(e.remoteHelper=e.remote,p.Fn.set(e.channel,d)),s=X({props:{src:e.local+"#_4"+e.channel},onLoad:function n(){var t=s||this;C(t,"load",n),p.Fn.set(e.channel+"_load",m),function i(){typeof t.contentWindow.sendMessage=="function"?h():r(i,50)}()}})},init:function(){_(n.onDOMReady,n)}}},p.stack.HashTransport=function(t){function m(e){n("sending message '"+(l+1)+" "+e+"' to "+d);if(!h){n("no caller window");return}var r=t.remote+"#"+l++ +"_"+e;(o||!p?h.contentWindow:h).location=r}function g(e){f=e,n("received message '"+f+"' from "+d),i.up.incoming(f.substring(f.indexOf("_")+1),d)}function y(){if(!c)return;var e=c.location.href,t="",r=e.indexOf("#");r!=-1&&(t=e.substring(r)),t&&t!=f&&(n("poll: new message"),g(t))}function b(){n("starting polling"),u=setInterval(y,a)}var n=Q.getTracer("easyXDM.stack.HashTransport");n("constructor");var i,s=this,o,u,a,f,l,c,h,p,d;return i={outgoing:function(e,t){m(e)},destroy:function(){e.clearInterval(u),(o||!p)&&h.parentNode.removeChild(h),h=null},onDOMReady:function(){o=t.isHost,a=t.interval,f="#"+t.channel,l=0,p=t.useParent,d=j(t.remote);if(o){t.props={src:t.remote,name:v+t.channel+"_provider"};if(p)t.onLoad=function(){c=e,b(),i.up.callback(!0)};else{var s=0,u=t.delay/50;(function m(){if(++s>u)throw n("unable to get reference to _listenerWindow, giving up"),new Error("Unable to reference listenerwindow");try{c=h.contentWindow.frames[v+t.channel+"_consumer"]}catch(e){}c?(b(),n("got a reference to _listenerWindow"),i.up.callback(!0)):r(m,50)})()}h=X(t)}else c=e,b(),p?(h=parent,i.up.callback(!0)):(z(t,{props:{src:t.remote+"#"+t.channel+new Date,name:v+t.channel+"_consumer"},onLoad:function(){i.up.callback(!0)}}),h=X(t))},init:function(){_(i.onDOMReady,i)}}},p.stack.ReliableBehavior=function(e){var t=Q.getTracer("easyXDM.stack.ReliableBehavior");t("constructor");var n,r,i=0,s=0,o="";return n={incoming:function(e,u){t("incoming: "+e);var a=e.indexOf("_"),f=e.substring(0,a).split(",");e=e.substring(a+1),f[0]==i&&(t("message delivered"),o="",r&&r(!0)),e.length>0&&(t("sending ack, and passing on "+e),n.down.outgoing(f[1]+","+i+"_"+o,u),s!=f[1]&&(s=f[1],n.up.incoming(e,u)))},outgoing:function(e,t,u){o=e,r=u,n.down.outgoing(s+","+ ++i+"_"+e,t)}}},p.stack.QueueBehavior=function(e){function p(){if(e.remove&&o.length===0){t("removing myself from the stack"),K(n);return}if(u||o.length===0||f)return;t("dispatching from queue"),u=!0;var i=o.shift();n.down.outgoing(i.data,i.origin,function(e){u=!1,i.callback&&r(function(){i.callback(e)},0),p()})}var t=Q.getTracer("easyXDM.stack.QueueBehavior");t("constructor");var n,o=[],u=!0,a="",f,l=0,c=!1,h=!1;return n={init:function(){R(e)&&(e={}),e.maxLength&&(l=e.maxLength,h=!0),e.lazy?c=!0:n.down.init()},callback:function(e){u=!1;var t=n.up;p(),t.callback(e)},incoming:function(r,s){if(h){var o=r.indexOf("_"),u=parseInt(r.substring(0,o),10);a+=r.substring(o+1),u===0?(t("received the last fragment"),e.encode&&(a=i(a)),n.up.incoming(a,s),a=""):t("waiting for more fragments, seq="+r)}else n.up.incoming(r,s)},outgoing:function(r,i,u){e.encode&&(r=s(r));var a=[],f;if(h){while(r.length!==0)f=r.substring(0,l),r=r.substring(f.length),a.push(f);while(f=a.shift())t("enqueuing"),o.push({data:a.length+"_"+f,origin:i,callback:a.length===0?u:null})}else o.push({data:r,origin:i,callback:u});c?n.down.init():p()},destroy:function(){t("destroy"),f=!0,n.down.destroy()}}},p.stack.VerifyBehavior=function(e){function o(){t("requesting verification"),r=Math.random().toString(16).substring(2),n.down.outgoing(r)}var t=Q.getTracer("easyXDM.stack.VerifyBehavior");t("constructor");if(R(e.initiate))throw new Error("settings.initiate is not set");var n,r,i,s=!1;return n={incoming:function(s,u){var a=s.indexOf("_");a===-1?s===r?(t("verified, calling callback"),n.up.callback(!0)):i||(t("returning secret"),i=s,e.initiate||o(),n.down.outgoing(s)):s.substring(0,a)===i&&n.up.incoming(s.substring(a+1),u)},outgoing:function(e,t,i){n.down.outgoing(r+"_"+e,t,i)},callback:function(t){e.initiate&&o()}}},p.stack.RpcBehavior=function(e,t){function u(e){e.jsonrpc="2.0",r.down.outgoing(i.stringify(e))}function f(e,t){var r=Array.prototype.slice;return n("creating method "+t),function(){n("executing method "+t);var i=arguments.length,a,f={method:t};i>0&&typeof arguments[i-1]=="function"?(i>1&&typeof arguments[i-2]=="function"?(a={success:arguments[i-2],error:arguments[i-1]},f.params=r.call(arguments,0,i-2)):(a={success:arguments[i-1]},f.params=r.call(arguments,0,i-1)),o[""+ ++s]=a,f.id=s):f.params=r.call(arguments,0),e.namedParams&&f.params.length===1&&(f.params=f.params[0]),u(f)}}function l(e,t,r,i){if(!r){n("requested to execute non-existent procedure "+e),t&&u({id:t,error:{code:-32601,message:"Procedure not found."}});return}n("requested to execute procedure "+e);var s,o;t?(s=function(e){s=a,u({id:t,result:e})},o=function(e,n){o=a;var r={id:t,error:{code:-32099,message:e}};n&&(r.error.data=n),u(r)}):s=o=a,x(i)||(i=[i]);try{var f=r.method.apply(r.scope,i.concat([s,o]));R(f)||s(f)}catch(l){o(l.message)}}var n=Q.getTracer("easyXDM.stack.RpcBehavior"),r,i=t.serializer||U(),s=0,o={};return r={incoming:function(e,r){var s=i.parse(e);if(s.method)n("received request to execute method "+s.method+(s.id?" using callback id "+s.id:"")),t.handle?t.handle(s,u):l(s.method,s.id,t.local[s.method],s.params);else{n("received return value destined to callback with id "+s.id);var a=o[s.id];s.error?a.error?a.error(s.error):n("unhandled error returned."):a.success&&a.success(s.result),delete o[s.id]}},init:function(){n("init");if(t.remote){n("creating stubs");for(var i in t.remote)t.remote.hasOwnProperty(i)&&(e[i]=f(t.remote[i],i))}r.down.init()},destroy:function(){n("destroy");for(var i in t.remote)t.remote.hasOwnProperty(i)&&e.hasOwnProperty(i)&&delete e[i];r.down.destroy()}}},o.easyXDM=p})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);