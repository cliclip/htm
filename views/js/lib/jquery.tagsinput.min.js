/*

	jQuery Tags Input Plugin 1.3.3

	Copyright (c) 2011 XOXCO, Inc

	Documentation for this plugin lives here:
	http://xoxco.com/clickable/jquery-tags-input

	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php

	ben@xoxco.com

*/(function(e){var t=new Array,n=new Array;e.fn.doAutosize=function(t){var n=e(this).data("minwidth"),r=e(this).data("maxwidth"),i="",s=e(this),o=e("#"+e(this).data("tester_id"));if(i===(i=s.val()))return;var u=i.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");o.html(u);var a=o.width(),f=a+t.comfortZone>=n?a+t.comfortZone:n,l=s.width(),c=f<l&&f>=n||f>n&&f<r;c&&s.width(f)},e.fn.resetAutosize=function(t){var n=e(this).data("minwidth")||t.minInputWidth||e(this).width(),r=e(this).data("maxwidth")||t.maxInputWidth||e(this).closest(".tagsinput").width()-t.inputPadding,i="",s=e(this),o=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:s.css("fontSize"),fontFamily:s.css("fontFamily"),fontWeight:s.css("fontWeight"),letterSpacing:s.css("letterSpacing"),whiteSpace:"nowrap"}),u=e(this).attr("id")+"_autosize_tester";!e("#"+u).length>0&&(o.attr("id",u),o.appendTo("body")),s.data("minwidth",n),s.data("maxwidth",r),s.data("tester_id",u),s.css("width",n)},e.fn.addTag=function(r,i){return i=jQuery.extend({focus:!1,callback:!0},i),this.each(function(){var s=e(this).attr("id"),o=e(this).val().split(t[s]);o[0]==""&&(o=new Array),r=jQuery.trim(r.toLocaleLowerCase());if(i.unique){var u=e(o).tagExist(r);u==1&&e("#"+s+"_tag").addClass("not_valid")}else var u=!1;if(r!=""&&u!=1){e("<span>").addClass("tag").append(e("<span>").text(r),"<a>&nbsp;&nbsp;&nbsp;</a>",e("<a>",{href:"#",title:"Removing tag",text:" X"}).addClass("del").click(function(){return e("#"+s).removeTag(escape(r))})).mouseover(function(t){e(e(t.currentTarget)[0].children[1]).hide(),e(e(t.currentTarget)[0].children[2]).show()}).mouseout(function(t){e(e(t.currentTarget)[0].children[1]).show(),e(e(t.currentTarget)[0].children[2]).hide()}).insertBefore("#"+s+"_addTag"),o.push(r),e("#"+s+"_tag").val(""),i.focus?e("#"+s+"_tag").focus():e("#"+s+"_tag").blur(),e.fn.tagsInput.updateTagsField(this,o);if(i.callback&&n[s]&&n[s].onAddTag){var a=n[s].onAddTag;a.call(this,r)}if(n[s]&&n[s].onChange){var f=o.length,a=n[s].onChange;a.call(this,e(this),o[f-1])}}}),!1},e.fn.removeTag=function(r){return r=unescape(r),this.each(function(){var s=e(this).attr("id"),o=e(this).val().split(t[s]);e("#"+s+"_tagsinput .tag").remove(),str="";for(i=0;i<o.length;i++)o[i]!=r&&(str=str+t[s]+o[i]);e.fn.tagsInput.importTags(this,str);if(n[s]&&n[s].onRemoveTag){var u=n[s].onRemoveTag;u.call(this,r)}}),!1},e.fn.tagExist=function(t){return jQuery.inArray(t,e(this))>=0},e.fn.importTags=function(t){id=e(this).attr("id"),e("#"+id+"_tagsinput .tag").remove(),e.fn.tagsInput.importTags(this,t)},e.fn.tagsInput=function(r){var s=jQuery.extend({interactive:!0,defaultText:_i18n("tag.add_tag"),minChars:0,maxChars:10,width:"270px",height:"75px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},r);return this.each(function(){s.hide&&e(this).hide();var r=e(this).attr("id"),o=jQuery.extend({pid:r,real_input:"#"+r,holder:"#"+r+"_tagsinput",input_wrapper:"#"+r+"_addTag",fake_input:"#"+r+"_tag"},s);t[r]=o.delimiter;if(s.onAddTag||s.onRemoveTag||s.onChange)n[r]=new Array,n[r].onAddTag=s.onAddTag,n[r].onRemoveTag=s.onRemoveTag,n[r].onChange=s.onChange;var u='<div id="'+r+'_tagsinput" class="tagsinput"><div id="'+r+'_addTag">';s.interactive&&(u=u+'<input id="'+r+'_tag" value="" data-default="'+s.defaultText+'" maxlength="10"/><div class="taglistDiv" style="display:none;" ></div>'),u+='</div><div class="tags_clear"></div></div>',e(u).insertAfter(this),e(o.real_input).val()!=""&&e.fn.tagsInput.importTags(e(o.real_input),e(o.real_input).val());if(s.interactive){e(o.fake_input).val(e(o.fake_input).attr("data-default")),e(o.fake_input).css("color",s.placeholderColor),e(o.fake_input).resetAutosize(s),e(o.holder).bind("click",o,function(t){e(t.data.fake_input).focus()}),e(o.fake_input).bind("input",o,function(t){var n=e.trim(e(o.fake_input).val());App.vent.trigger("app.tagsinput:taglist",n),e(".taglistDiv").children().children().length!=0?e(".taglistDiv").show():e(".taglistDiv").hide()}),e(o.fake_input).bind("click",o,function(t){var n=e.trim(e(o.fake_input).val());App.vent.trigger("app.tagsinput:taglist",n)});var a=!0;e(".taglistDiv").bind("mouseover",function(e){a=!1}),e(".taglistDiv").bind("mouseout",function(e){a=!0}),e(o.fake_input).bind("blur",function(t){a?setTimeout(function(){App.vent.trigger("app.clipapp.taglist:close"),e(".taglistDiv").hide()},200):e(o.fake_input).focus()}),App.vent.unbind("app.clipapp.taglist:gettag"),App.vent.bind("app.clipapp.taglist:gettag",function(t){t&&(e(o.real_input).addTag(t,{focus:!0,unique:s.unique}),App.vent.trigger("app.tagsinput:taglist"))}),e(o.fake_input).bind("focus",o,function(t){e("#"+r+"_tag").siblings("span.error").remove(),e("#"+r+"_tag").removeClass("error"),e(".taglistDiv").children().children().length!=0?e(".taglistDiv").show():e(".taglistDiv").hide()}),e(o.fake_input).bind("focus",o,function(t){e(t.data.fake_input).val()==e(t.data.fake_input).attr("data-default")&&e(t.data.fake_input).val(""),e(t.data.fake_input).css("color","#000000")});if(s.autocomplete_url!=undefined){autocomplete_options={source:s.autocomplete_url};for(attrname in s.autocomplete)autocomplete_options[attrname]=s.autocomplete[attrname];jQuery.Autocompleter!==undefined?(e(o.fake_input).autocomplete(s.autocomplete_url,s.autocomplete),e(o.fake_input).bind("result",o,function(t,n,i){n&&e("#"+r).addTag(n[0]+"",{focus:!0,unique:s.unique})})):jQuery.ui.autocomplete!==undefined&&(e(o.fake_input).autocomplete(autocomplete_options),e(o.fake_input).bind("autocompleteselect",o,function(t,n){return e(t.data.real_input).addTag(n.item.value,{focus:!0,unique:s.unique}),!1}))}else e(o.fake_input).bind("blur",o,function(t){var n=e(this).attr("data-default");if(e(t.data.fake_input).val()!=""&&e(t.data.fake_input).val()!=n&&a){var o=0,u=e(t.data.fake_input).val();for(i=0;i<u.length;i++)u.charCodeAt(i)>256?o+=2:o++;if(t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=o))e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:s.unique});else{var f=_i18n("tag.beyond");e("#"+r+"_tag").after("<span class='error'>"+f+"</span>"),App.vent.trigger("app.clipapp.tagsinput:error")}}else e(t.data.fake_input).val(e(t.data.fake_input).attr("data-default")),e(t.data.fake_input).css("color",s.placeholderColor);return!1});e(o.fake_input).bind("keypress",o,function(t){if(t.which==t.data.delimiter.charCodeAt(0)||t.which==13){var n=0,o=e(t.data.fake_input).val();for(i=0;i<o.length;i++)o.charCodeAt(i)>256?n+=2:n++;if(t.data.minChars<=e(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=n))e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:!0,unique:s.unique});else{var u=_i18n("tag.beyond");e("#"+r+"_tag").after("<span class='error'>"+u+"</span>")}return e(t.data.fake_input).resetAutosize(s),App.vent.trigger("app.tagsinput:taglist"),!1}t.data.autosize&&e(t.data.fake_input).doAutosize(s)}),o.removeWithBackspace&&e(o.fake_input).bind("keydown",function(t){if(t.keyCode!=8||e(this).val()!="")if(t.keyCode==38){var n=!0,r=e(".taglistDiv").children().children();for(var i=0;i<r.length;i++)n&&e(r[i]).css("background-color")=="rgb(136, 136, 136)"&&(e(r[i]).css("background-color",""),e(r[i-1]).css("background-color","#888"),e(o.fake_input).val(e(r[i-1]).text()),n=!1);n&&(e(r[r.length-1]).css("background-color","#888"),e(o.fake_input).val(e(r[length-1]).text()))}else if(t.keyCode==40){var n=!0,r=e(".taglistDiv").children().children();for(var i=0;i<r.length;i++)n&&e(r[i]).css("background-color")=="rgb(136, 136, 136)"&&(e(r[i]).css("background-color",""),e(r[i+1]).css("background-color","#888"),e(o.fake_input).val(e(r[i+1]).text()),n=!1);n&&(e(r[0]).css("background-color","#888"),e(o.fake_input).val(e(r[0]).text()))}}),o.unique&&e(o.fake_input).keydown(function(t){(t.keyCode==8||String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&e(this).removeClass("not_valid")})}return!1}),this},e.fn.tagsInput.updateTagsField=function(n,r){var i=e(n).attr("id");e(n).val(r.join(t[i]))},e.fn.tagsInput.importTags=function(r,s){e(r).val("");var o=e(r).attr("id"),u=s.split(t[o]);for(i=0;i<u.length;i++)e(r).addTag(u[i],{focus:!1,callback:!1});if(n[o]&&n[o].onChange){var a=n[o].onChange;a.call(r,r,u[i])}}})(jQuery);